<?php

/**
 * Domaine_scientifiqueTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class Domaine_scientifiqueTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object Domaine_scientifiqueTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Domaine_scientifique');
    }

    /**
     * Construit un query permettant de recuperer les domaines scientifiques
     * actif, triés par ordre escendant de l'intitulé
     *
     * @return object Doctrine_Query
     *
     * @author Simeon PETEV
     */
    public function buildQueryDomainesActifsOrdreAscPourSelectBox()
    {
      if (sfContext::hasInstance())
        sfContext::getInstance()->getLogger()->debug("{".__CLASS__."} [".__FUNCTION__."] /Ligne: ".__LINE__."/ DEBUT; ");

      $objQuery = $this->getQueryObject()
                          ->where('est_actif = 1')
                          ->orderBy('intitule ASC');

      if (sfContext::hasInstance())
        sfContext::getInstance()->getLogger()->debug("{".__CLASS__."} [".__FUNCTION__."] /Ligne: ".__LINE__."/ FIN; ");

      return $objQuery;
    }

    /**
     * Récupere les domaines scientifiques qui ont été associées à un dossier
     * @param string $strTypeDossier
     * @return Doctrine_Collection contenant les domaines scientifiques
     */
    public function getDomaineScientifiqueAAfficher($strTypeDossier)
    {
      $DossierTable = $strTypeDossier."Table";
      $arrDomaineScientifiqueConcernes = array();
      $arrDomScientiquePourSelectBox = new Doctrine_Collection('Domaine_scientifique');

      //récuperation de tous les domaines scientifiques
      $arrDomaineScientifiqueActifs = $this->createQuery('d')
                                  ->where('d.est_actif = 1')
                                  ->execute();

      //récuperation des domaines scientifiques qui ont été associées à un dossier
      $arrDomScientifiqueDossiers = call_user_func($DossierTable.'::getInstance')->getDomaineScientifiqueDossier();

      //ajout des domaines scientifiques dans $arrDomScientiquePourSelectBox
      if($arrDomaineScientifiqueActifs->count() > 0)
      {
        foreach ($arrDomaineScientifiqueActifs as $objDomaineScientifique)
        {
          if(in_array($objDomaineScientifique->getId(),$arrDomScientifiqueDossiers) && !in_array($objDomaineScientifique,$arrDomaineScientifiqueConcernes))
          {
            $arrDomaineScientifiqueConcernes[] = $objDomaineScientifique;
            $arrDomScientiquePourSelectBox->add($objDomaineScientifique);
          }
        }
      }

      return $arrDomScientiquePourSelectBox;
    }

    
}