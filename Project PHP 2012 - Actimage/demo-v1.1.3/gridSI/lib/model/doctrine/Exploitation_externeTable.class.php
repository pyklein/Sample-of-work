<?php

/**
 * Exploitation_externeTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class Exploitation_externeTable extends Doctrine_Table {

  /**
   * Returns an instance of this class.
   *
   * @return object Exploitation_externeTable
   */
  public static function getInstance() {
    return Doctrine_Core::getTable('Exploitation_externe');
  }

  /**
   * Retourne les exploitation Externe en function d'une part Inventive
   * @param Integer $partInventiveId
   * @return Doctrine Query
   * @author Alexandre WETTA
   */
  public function retrieveExploitationExterneByPartInventive($partInventiveId) {

    $doctrineQuery = $this->createQuery('e')->where('e.part_inventive_id = ?', $partInventiveId)
                    ->orderBy('date_versement DESC');

    return $doctrineQuery->execute();
  }


    public function getExploitationExterneParDossierParInventeur($intDossierBpiId,$intInventeurId)
    {
      $objRequete = $this->createQuery('e')
                       ->leftJoin("e.Part_inventive p ON e.part_inventive_id = p.id")
                       ->where("p.dossier_bpi_id = ?", $intDossierBpiId)
                       ->andWhere("p.inventeur_id = ?", $intInventeurId);

      return $objRequete->execute();
    }

    public function getExploitationExterneParDossier($intDossierBpiId)
    {
      $objRequete = $this->createQuery('e')
                       ->leftJoin("e.Part_inventive p ON e.part_inventive_id = p.id")
                       ->where("p.dossier_bpi_id = ?", $intDossierBpiId)
                       ->orderBy("e.id");

    return $objRequete->count();

    }

}
