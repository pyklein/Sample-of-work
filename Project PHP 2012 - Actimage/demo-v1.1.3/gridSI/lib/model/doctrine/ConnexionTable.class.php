<?php

/**
 * ConnexionTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ConnexionTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object ConnexionTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Connexion');
    }

    /**
     * Retourne l'enregistrement BDD de la session en cours
     *
     * @return doctrineRecord
     * @author Julien GAUTIER
     */
    public function getLastEntry()
    {
      $objLastEntry = $this->createQuery()
                      ->orderBy('date_debut DESC')->orderBy('id DESC')->execute();
      $objLastEntry = $objLastEntry->count() > 0 ? $objLastEntry->getFirst() : null;
      return $objLastEntry;
    }

    /**
     * Incrément du compteur
     *
     * @author Julien GAUTIER
     */
    public function addToCompteur()
    {
        $lastEntry =  $this->getLastEntry();
        if ($lastEntry) {
          $lastEntry->setCompteur($lastEntry->getCompteur()+1);
          $lastEntry->save();
        } else {
          $connexion = new Connexion();
          $connexion->setCompteur(1);
          $connexion->setDateDebut(date("Y-m-d"));
          $connexion->save();
        }
    }

    /**
     * Réinitialisation du compteur (ajout d'une nouvelle entrée à 0)
     *
     * @return DoctrineRecord
     * @author Julien GAUTIER
     */
    public function reinitCompteur()
    {
          $connexion = new Connexion();
          $connexion->setCompteur(0);
          $connexion->setDateDebut(date("Y-m-d"));
          $connexion->save();
          return $connexion;
    }

    /**
     * Historique des connexions
     *
     * @return DoctrineCollection
     * @author Julien GAUTIER
     */
    public function getListeConnexions() {
      $objListConexions = $this->createQuery()->orderBy('date_debut DESC')->orderBy('id DESC')->execute();
      return $objListConexions;
    }
}