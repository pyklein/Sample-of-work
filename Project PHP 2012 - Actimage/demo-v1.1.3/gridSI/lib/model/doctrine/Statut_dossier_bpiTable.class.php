<?php

/**
 * Statut_dossier_bpiTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class Statut_dossier_bpiTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object Statut_dossier_bpiTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Statut_dossier_bpi');
    }

    /**
 *  Récupère le statut suivant de celui dont l'ID est passée (NULL accépté) en filtrant ou non les status innactifs
 * @param identifiant $intIdStatut  Identifiant du statut dont on veut trouver le suivant
 * @param bool        $filtreActifs Filtrage ou non des statuts innactifs
 * @return Doctrine_record          Statut recherché (ou false dans le cas ou il n'existe pas)
 */
  public function getNextStatut($intIdStatut, $filtreActifs = false) {
    //Si le statut n'est pas à la racine
    if ($intIdStatut != null) {
      $output = $this->findOneByPrecedentStatutDossierBpiId($intIdStatut);
    }
    //Si le statut est à la racine
    else {
      $output = $this->createQuery('s')->where('s.precedent_statut_dossier_bpi_id IS NULL')->execute();
      $output = $output[0];
    }

    if ($output != false) {
        if ($filtreActifs && !$output->getEstActif()) {
          return $this->getNextStatut($output->getId(), $filtreActifs);
        }
      }
    return $output;
  }

  //récupère tous les statuts de dossier dans l'ordre
  public function retrieveStatutsParOrdre($filtreActifs = false, $intIdCourant = null) {
    $objStatut = $this->findRoot($filtreActifs);
    $collectionStatut = new Doctrine_Collection('Statut_dossier_bpi');
    if ($objStatut->getId() != $intIdCourant) {
      $collectionStatut->add($objStatut);
    }
    $boolBoucle = true;

    while ($boolBoucle) {
      $objStatut = $this->getNextStatut($objStatut->getId(), $filtreActifs);


      if ($objStatut == false) {
        $boolBoucle = false;
      } else {
        if ($objStatut->getId() != $intIdCourant) {
          $collectionStatut->add($objStatut);
        }
      }
    }
    return $collectionStatut;
  }

  public function findRoot($filtreActifs = false) {
    return $this->getNextStatut(null, $filtreActifs);
  }
}